<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>ProductMS</title>
    <link rel="stylesheet" type="text/css" href="../static/src/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../static/css/formSelects-v4.css"/>
    <style type="text/css">
        body {
            padding: 20px;
            /*padding-left: 0px;*/
        }
    </style>
</head>
<body>
<div class="wrap-container">
    <form class="layui-form layui-form-pane" style="width: 100%;"
          method="post" action="" name="form">

        <div class="layui-form-item" style="display: none">
            <label class="layui-form-label">需求项编号</label>
            <div class="layui-input-block">
                <input type="text" name="id" disabled="disabled" autocomplete="off" class="layui-input"/>
            </div>
        </div>

        <div class="layui-form-item ">
            <label class="layui-form-label">需求编号</label>
            <div class="layui-input-block">
                <input type="text" name="reqNo" disabled="disabled" autocomplete="off" class="layui-input"/>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">需求项</label>
            <div class="layui-input-block">
                <input type="text" name="reqItemName" autocomplete="off"
                       class="layui-input"/>
            </div>

        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">需求项描述</label>
            <div class="layui-input-block">
                <input type="text" name="reqItemDesc" autocomplete="off"
                       class="layui-input"/>
            </div>

        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">上线日期</label>
            <div class="layui-input-block">
                <input type="text" id="onplan_date" name="onlineDatetime" autocomplete="off" class="layui-input"/>
            </div>

        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">对应开发任务</label>
            <div class="layui-input-block">
                <input type="text" name="reqItemDev" autocomplete="off"
                       class="layui-input"/>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">需求项状态</label>
            <div class="layui-input-block">
                <input type="text" name="reqItemStatus" autocomplete="off"
                       class="layui-input"/>
            </div>
        </div>

        <div class="layui-form-item" style="display:none">
            <label class="layui-form-label">操作人</label>
            <div class="layui-input-block">
                <input type="text" name="opPerson" id="opPerson" autocomplete="off"
                       class="layui-input"/>
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label">功能点</label>
            <div class="layui-input-block">
                <select name="funcId" xm-select="selectFunc" xm-select-direction="up"
                        xm-select-show-count="4" xm-select-height="36px">
                </select>
            </div>
        </div>


        <div class="layui-form-item">
            <div class="layui-input-block" style="float: right">
                <button type="button" class="layui-btn layui-btn-primary"
                        id="close">关闭
                </button>
                <button class="layui-btn" id="edit_form_btn" lay-submit=""
                        lay-filter="edit_form_btn">确认
                </button>
            </div>
        </div>
    </form>
</div>

<script src="../static/src/layui.all.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/src/public.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/js/common.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/js/formSelects-v4.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
    //Demo
    layui.use(['form', 'jquery', 'laydate', 'element', 'util'],
        function () {
            var form = layui.form;
            var $ = layui.jquery;
            var laydate = layui.laydate;
            form.render();

             redata = JSON.parse(decodeURIComponent(getRequestParam().obj));
            // console.log(redata);
            // console.log(redata.funcId);

            //监听提交
            form.on('submit(edit_form_btn)', function (data) {
                // layer.alert("zzf");
                // layer.alert(JSON.stringify(data.field));
                $.ajax({
                    url: '/updateReqItem',
                    data: data.field,
                    type: 'POST',//默认以get提交，以get提交如果是中文后台会出现乱码
                    dataType: 'json',
                    success: function (obj) {
                        // layer.close(index);//关闭
                        if (obj == 'success') {
                            pubUtil.msg('需求项编辑成功', layer, 1, function () {
                                $("#close").click();
                            }, 1000);
                        } else {
                            pubUtil.msg('需求项编辑失败', layer, 2, function () {
                            }, 1000);
                        }
                    }
                });
                return false;
            });

            namestr=[];
            $.ajax({
                url: "/listReqRalateFunc",
                type: "GET",
                data:{
                    id:redata.id, page:1, limit:10000
                },
                dataType:"json",
                success: function (resData) {
                    /*<![CDATA[*/
                    for(var i =0;i<resData.data.total;i++){
                        namestr.push(resData.data.list[i].id);
                    }
                    /*]]>*/
                    return namestr;
                }
            });
            // console.log(namestr);
            //多选下拉框
            var formSelects = layui.formSelects;
            formSelects.data('selectFunc', 'server', {
                url: "/listFunc"
                , data: {
                    page: 1,
                    limit: 10000,
                }
                , keyVal: 'id'
                , keyName: 'funcName'
                , beforeSuccess: function (id, url, searchVal, result) {  //success之前的回调, 干嘛呢? 处理数据的, 如果后台不想修改数据, 你也不想修改源码, 那就用这种方式处理下数据结构吧
                    // 如果将ajax请求放在这里，这里的success会比后面的success后执行,坑！！！
                    result = result.data.list;
                    return result;  //必须return一个结果, 这个结果要符合对应的数据结构
                },
                success: function(id, url, searchVal, result){      //使用远程方式的success回调
                    // console.log(namestr);
                    formSelects.value(id, namestr);
                },
            });

            // formSelects.value('selectFunc', [2, 4]);

            //上线时间选择
            var onplanDate = laydate.render({
                elem: '#onplan_date',//选择器结束时间
                theme: 'molv',
                min: "1970-1-1",//设置min默认最小值
                max: "2099-12-31",
            });

        });
</script>
<script>

</script>
</body>

</html>